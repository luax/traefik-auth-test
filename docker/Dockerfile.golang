FROM golang
ARG SERVICE_ENV
ARG SERVICE_NAME
ARG PROJECT_NAME
RUN test -n "${SERVICE_NAME}"
RUN test -n "${PROJECT_NAME}"
ENV SERVICE_ENV ${SERVICE_ENV:-"production"}
ENV SERVICE_NAME ${SERVICE_NAME}
ENV PROJECT_NAME ${PROJECT_NAME}
ENV PORT 8080
WORKDIR /go
ADD . /go/src/${PROJECT_NAME}
EXPOSE ${PORT}
RUN go install "${PROJECT_NAME}/services/${SERVICE_NAME}"
WORKDIR src/${PROJECT_NAME}/services/${SERVICE_NAME}
CMD "/go/bin/${SERVICE_NAME}"
